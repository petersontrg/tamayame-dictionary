{% extends "layout.html" %}
{% block content %}

<h2 class="text-2xl font-bold mb-6 text-gray-800">Morpheme Index</h2>

<form method="get" class="mb-6">
  <input type="text" name="q" placeholder="Search morphemes..."
         value="{{ request.args.get('q', '') }}"
         class="border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 px-4 py-2 rounded-md w-full max-w-md shadow-sm">
</form>

<div class="overflow-x-auto">
  <table class="min-w-full text-sm border border-gray-300 shadow-sm bg-white">
    <thead class="bg-indigo-50 border-b border-gray-300">
      <tr>
        <th class="text-left px-4 py-2 font-semibold text-gray-700">Segment</th>
        <th class="text-left px-4 py-2 font-semibold text-gray-700">Gloss</th>
        <th class="text-left px-4 py-2 font-semibold text-gray-700">Category</th>
        <th class="text-left px-4 py-2 font-semibold text-gray-700">Used In</th>
        <th class="text-left px-4 py-2 font-semibold text-gray-700">Status</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-200">
      {% for morpheme in morphemes %}
        {% set segment = morpheme.segment %}
        {% set display_segment = segment %}
        {% if morpheme.position == 'prefix' %}
          {% set display_segment = segment ~ '-' %}
        {% elif morpheme.position == 'suffix' %}
          {% set display_segment = '-' ~ segment %}
        {% endif %}

        {% if not request.args.q or request.args.q.lower() in segment.lower() %}
        <tr class="hover:bg-indigo-50">
          <td class="px-4 py-2 font-mono text-indigo-700">
            {% if morpheme.promoted %}
              <a href="{{ url_for('entry_detail', entry_id=morpheme.entry_id) }}" class="hover:underline">{{ display_segment }}</a>
            {% else %}
              {{ display_segment }}
            {% endif %}
          </td>
          <td class="px-4 py-2">{{ morpheme.gloss }}</td>
          <td class="px-4 py-2 text-gray-600">{{ morpheme.category }}</td>
          <td class="px-4 py-2 space-x-1">
            {% if morpheme.headwords %}
              {% for word in morpheme.headwords %}
                <span class="inline-block bg-gray-100 text-gray-800 px-2 py-0.5 rounded-full text-xs">{{ word }}</span>
              {% endfor %}
            {% else %}
              <span class="text-gray-400 italic">—</span>
            {% endif %}
          </td>
          <td class="px-4 py-2">
            {% if morpheme.promoted %}
              <span class="inline-block text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded">✔ Promoted</span>
            {% else %}
              <span class="inline-block text-xs bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded">Not yet in entries</span>
            {% endif %}
          </td>
        </tr>
        {% endif %}
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}